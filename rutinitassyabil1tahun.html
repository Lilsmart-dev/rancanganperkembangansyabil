<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pelacak Harian Perkembangan Anak</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for plotting graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            color: #333;
        }
        .container {
            max-width: 960px;
        }
        .section-header {
            background-color: #e0f2fe; /* Lighter blue */
            border-left: 8px solid #3b82f6; /* Blue border */
        }
        .activity-card {
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #3b82f6; /* Blue */
            color: white;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2563eb; /* Darker blue on hover */
        }
        .btn-danger {
            background-color: #ef4444; /* Red */
            color: white;
            transition: background-color 0.3s ease;
        }
        .btn-danger:hover {
            background-color: #dc2626; /* Darker red on hover */
        }
        textarea {
            resize: vertical; /* Allow vertical resizing of textareas */
        }
        input[type="radio"]:checked + label {
            background-color: #bfdbfe; /* Light blue when selected */
            border-color: #60a5fa;
            color: #1e40af;
            font-weight: 600;
        }
        label.radio-label {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        label.radio-label:hover {
            background-color: #f1f5f9;
        }
        canvas {
            background-color: #ffffff; /* White background for the chart area */
            border-radius: 0.5rem;
            padding: 1rem;
        }
        .visual-schedule-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 0.5rem;
        }
        .visual-schedule-icon {
            font-size: 2.5rem; /* Larger emoji/icon size */
            margin-bottom: 0.5rem;
        }
        .visual-schedule-time {
            font-weight: bold;
            color: #3b82f6; /* Blue for time */
        }
        .visual-schedule-activity {
            font-size: 0.9rem;
            color: #4b5563;
        }

        /* Custom Message Box Styles */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .message-box-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .message-box-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .message-box-overlay.active .message-box-content {
            transform: translateY(0);
        }
        .message-box-content h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
        }
        .message-box-content p {
            margin-bottom: 1.5rem;
            color: #555;
        }
        .message-box-actions button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .message-box-actions .confirm-btn {
            background-color: #3b82f6;
            color: white;
            margin-right: 0.5rem;
        }
        .message-box-actions .confirm-btn:hover {
            background-color: #2563eb;
        }
        .message-box-actions .cancel-btn {
            background-color: #e5e7eb;
            color: #374151;
        }
        .message-box-actions .cancel-btn:hover {
            background-color: #d1d5db;
        }
        .message-box-actions .ok-btn {
            background-color: #3b82f6;
            color: white;
        }
        .message-box-actions .ok-btn:hover {
            background-color: #2563eb;
        }

        /* Loading Indicator Styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Above message box */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            flex-direction: column;
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3b82f6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            margin-top: 1rem;
            font-size: 1.1rem;
            color: #3b82f6;
            font-weight: 600;
        }

        /* Summary Output Styles */
        #aiSummaryOutput {
            background-color: #e0f2fe; /* Light blue background */
            border-left: 4px solid #3b82f6;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            white-space: pre-wrap; /* Preserve whitespace and line breaks */
            display: none; /* Hidden by default */
        }
        #aiSummaryOutput h3 {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
            color: #1e40af;
        }
        #aiSummaryOutput p {
            font-size: 1rem;
            line-height: 1.5;
            color: #374151;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto bg-white rounded-lg shadow-xl p-6 md:p-10 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Pelacak Harian Perkembangan Anak üß†</h1>
        <p class="text-center text-gray-600 mb-4">Isi data harian untuk memantau kemajuan perkembangan anak Anda.</p>
        <p class="text-center text-gray-600 text-sm mb-8">Tanggal pembuatan: 15/08/2025</p>

        <!-- Profil Anak -->
        <div class="bg-blue-50 p-6 rounded-lg mb-8 border-l-4 border-blue-400">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Profil Sensoris & Perilaku Anak
            </h2>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
                <li><strong class="text-gray-900">Nama:</strong> Muhammad Syabil Raindra</li>
                <li><strong class="text-gray-900">Usia:</strong> 6 tahun</li>
                <li><strong class="text-gray-900">Jenis Kelamin:</strong> Laki-laki</li>
                <li><strong class="text-gray-900">Diagnosis:</strong> ADHD + tantangan regulasi sensoris (SPD)</li>
                <li><strong class="text-gray-900">Tipe ADHD Dominan:</strong>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li><strong class="text-red-600">üî¥ Hyper taktil</strong> (sensitif terhadap sentuhan)</li>
                        <li><strong class="text-blue-600">üîµ Hypo proprioseptif</strong> (kurang cari tekanan)</li>
                        <li><strong class="text-gray-800">‚ö´ Kesulitan modulasi gerakan</strong> ‚Üí sulit atur energi, lempar batu dll.</li>
                        <li><strong class="text-green-600">üü¢ Fokus sangat visual-kines</strong> (belajar dari gerak & lihat)</li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- Visual Schedule Rutinitas Harian (General Overview) -->
        <div class="mb-10">
            <h2 class="section-header p-4 text-xl font-semibold text-gray-800 rounded-tr-lg rounded-br-lg mb-6">üóìÔ∏è Rutinitas Harian Visual (Gambaran Umum)</h2>
            <p class="text-gray-600 mb-6">Visualisasi rutinitas harian utama untuk membantu Muhammad Syabil Raindra memahami urutan kegiatan secara umum.</p>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 activity-card p-5 rounded-lg">
                <div class="visual-schedule-item">
                    <span class="visual-schedule-icon">‚òÄÔ∏è</span>
                    <span class="visual-schedule-time">Pagi (08.00)</span>
                    <span class="visual-schedule-activity">Tantangan Cepat</span>
                </div>
                <div class="visual-schedule-item">
                    <span class="visual-schedule-icon">üíß</span>
                    <span class="visual-schedule-time">Menjelang Siang</span>
                    <span class="visual-schedule-activity">Pemimpin Tim</span>
                </div>
                <div class="visual-schedule-item">
                    <span class="visual-schedule-icon">üéØ</span>
                    <span class="visual-schedule-time">Sore</span>
                    <span class="visual-schedule-activity">Target Juara</span>
                </div>
                <div class="visual-schedule-item">
                    <span class="visual-schedule-icon">üìö</span>
                    <span class="visual-schedule-time">Malam</span>
                    <span class="visual-schedule-activity">Bos Cerita</span>
                </div>
                 <div class="visual-schedule-item">
                    <span class="visual-schedule-icon">üßº</span>
                    <span class="visual-schedule-time">Pagi/Malam</span>
                    <span class="visual-schedule-activity">Mandi</span>
                </div>
                <div class="visual-schedule-item">
                    <span class="visual-schedule-icon">üñåÔ∏è</span>
                    <span class="visual-schedule-time">Sebelum Tidur</span>
                    <span class="visual-schedule-activity">Brushing & Tekanan</span>
                </div>
            </div>
        </div>

        <!-- Tanggal Input -->
        <div class="mb-8">
            <label for="recordDate" class="block text-lg font-medium text-gray-700 mb-2">Tanggal Catatan:</label>
            <input type="date" id="recordDate" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-gray-700" value="">
        </div>

        <!-- Bagian Terapi Neuro-Sensori -->
        <div class="mb-10">
            <h2 class="section-header p-4 text-xl font-semibold text-gray-800 rounded-tr-lg rounded-br-lg mb-6">üìã Terapi Neuro-Sensori Terstruktur</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Aktivitas 1: Tantangan Cepat ‚Äì Lari zig-zag + ambil batu -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-blue-700 mb-3">Tantangan Cepat ‚Äì Lari zig-zag + ambil batu</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Motorik Kasar, Motorik Halus, Kognitif, Sosial-Emosi, Sensoris Integrasi, Komunikasi.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Proprioseptif & vestibular, koordinasi tubuh, transisi fokus.</p>
                    <p class="text-sm text-gray-600 mb-4">Penjelasan: Anak berlari zig-zag, mengambil batu, lalu memasukkan ke ember. Setelah itu duduk dan main puzzle kecil.</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="tantanganCepat-1" name="tantanganCepatLevel" value="1" class="hidden"><label for="tantanganCepat-1" class="radio-label">1</label>
                            <input type="radio" id="tantanganCepat-2" name="tantanganCepatLevel" value="2" class="hidden"><label for="tantanganCepat-2" class="radio-label">2</label>
                            <input type="radio" id="tantanganCepat-3" name="tantanganCepatLevel" value="3" class="hidden"><label for="tantanganCepat-3" class="radio-label">3</label>
                            <input type="radio" id="tantanganCepat-4" name="tantanganCepatLevel" value="4" class="hidden"><label for="tantanganCepat-4" class="radio-label">4</label>
                            <input type="radio" id="tantanganCepat-5" name="tantanganCepatLevel" value="5" class="hidden"><label for="tantanganCepat-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="tantanganCepatSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="tantanganCepatSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 3x coba, waktu tercepat 18 detik.">
                    </div>
                    <div>
                        <label for="tantanganCepatCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="tantanganCepatCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Amati apakah transisi dari gerak cepat ke duduk tenang lancar atau masih gelisah."></textarea>
                    </div>
                </div>

                <!-- Aktivitas 2: Pemimpin Tim ‚Äì Bangun menara batu/kayu -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-blue-700 mb-3">Pemimpin Tim ‚Äì Bangun menara batu/kayu</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Motorik Kasar, Motorik Halus, Komunikasi, Kognitif, Sosial-Emosi, Sensoris Integrasi.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Taktil + proprioseptif, keterampilan sosial, bahasa instruksi.</p>
                    <p class="text-sm text-gray-600 mb-4">Penjelasan: Anak memimpin proyek membangun menara, memberi instruksi, lalu berganti peran.</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="pemimpinTim-1" name="pemimpinTimLevel" value="1" class="hidden"><label for="pemimpinTim-1" class="radio-label">1</label>
                            <input type="radio" id="pemimpinTim-2" name="pemimpinTimLevel" value="2" class="hidden"><label for="pemimpinTim-2" class="radio-label">2</label>
                            <input type="radio" id="pemimpinTim-3" name="pemimpinTimLevel" value="3" class="hidden"><label for="pemimpinTim-3" class="radio-label">3</label>
                            <input type="radio" id="pemimpinTim-4" name="pemimpinTimLevel" value="4" class="hidden"><label for="pemimpinTim-4" class="radio-label">4</label>
                            <input type="radio" id="pemimpinTim-5" name="pemimpinTimLevel" value="5" class="hidden"><label for="pemimpinTim-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="pemimpinTimSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="pemimpinTimSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 5 instruksi verbal benar.">
                    </div>
                    <div>
                        <label for="pemimpinTimCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="pemimpinTimCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Lihat apakah anak tetap memimpin dengan jelas atau kehilangan fokus."></textarea>
                    </div>
                </div>

                <!-- Aktivitas 3: Target Juara ‚Äì Lempar batu/bola ke ember -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-blue-700 mb-3">Target Juara ‚Äì Lempar batu/bola ke ember</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Motorik Kasar, Motorik Halus, Kognitif, Sosial-Emosi, Sensoris Integrasi, Komunikasi.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Modulasi gerak, fokus visual, pengaturan tenaga.</p>
                    <p class="text-sm text-gray-600 mb-4">Penjelasan: 5 kali lempar ke ember dekat, 5 kali ke ember jauh. Skor dicatat.</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="targetJuara-1" name="targetJuaraLevel" value="1" class="hidden"><label for="targetJuara-1" class="radio-label">1</label>
                            <input type="radio" id="targetJuara-2" name="targetJuaraLevel" value="2" class="hidden"><label for="targetJuara-2" class="radio-label">2</label>
                            <input type="radio" id="targetJuara-3" name="targetJuaraLevel" value="3" class="hidden"><label for="targetJuara-3" class="radio-label">3</label>
                            <input type="radio" id="targetJuara-4" name="targetJuaraLevel" value="4" class="hidden"><label for="targetJuara-4" class="radio-label">4</label>
                            <input type="radio" id="targetJuara-5" name="targetJuaraLevel" value="5" class="hidden"><label for="targetJuara-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="targetJuaraSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="targetJuaraSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 6/10 tepat sasaran.">
                    </div>
                    <div>
                        <label for="targetJuaraCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="targetJuaraCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Amati apakah kekuatan sesuai instruksi atau berlebihan."></textarea>
                    </div>
                </div>

                <!-- Aktivitas 4: Bos Cerita ‚Äì Pilih urutan cerita dengan kartu visual -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-blue-700 mb-3">Bos Cerita ‚Äì Pilih urutan cerita dengan kartu visual</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Motorik Halus, Kognitif, Komunikasi, Sosial-Emosi, Sensoris Integrasi.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Auditori, pemahaman reseptif & ekspresif, menyusun urutan.</p>
                    <p class="text-sm text-gray-600 mb-4">Penjelasan: Anak memilih gambar cerita dan menentukan urutannya.</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="bosCerita-1" name="bosCeritaLevel" value="1" class="hidden"><label for="bosCerita-1" class="radio-label">1</label>
                            <input type="radio" id="bosCerita-2" name="bosCeritaLevel" value="2" class="hidden"><label for="bosCerita-2" class="radio-label">2</label>
                            <input type="radio" id="bosCerita-3" name="bosCeritaLevel" value="3" class="hidden"><label for="bosCerita-3" class="radio-label">3</label>
                            <input type="radio" id="bosCerita-4" name="bosCeritaLevel" value="4" class="hidden"><label for="bosCerita-4" class="radio-label">4</label>
                            <input type="radio" id="bosCerita-5" name="bosCeritaLevel" value="5" class="hidden"><label for="bosCerita-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="bosCeritaSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="bosCeritaSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: Urut 3 gambar dengan benar.">
                    </div>
                    <div>
                        <label for="bosCeritaCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="bosCeritaCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Perhatikan apakah anak mampu menjelaskan urutannya."></textarea>
                    </div>
                </div>

                <!-- Aktivitas 5: Brushing + Tekanan Dalam -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-blue-700 mb-3">Brushing + Tekanan Dalam</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Sensoris Integrasi, Sosial-Emosi, Komunikasi.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Taktil calming + proprioseptif, membantu tidur.</p>
                    <p class="text-sm text-gray-600 mb-4">Penjelasan: Brushing di lengan/kaki diikuti tekanan ringan ritmis.</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="brushingTekanan-1" name="brushingTekananLevel" value="1" class="hidden"><label for="brushingTekanan-1" class="radio-label">1</label>
                            <input type="radio" id="brushingTekanan-2" name="brushingTekananLevel" value="2" class="hidden"><label for="brushingTekanan-2" class="radio-label">2</label>
                            <input type="radio" id="brushingTekanan-3" name="brushingTekananLevel" value="3" class="hidden"><label for="brushingTekanan-3" class="radio-label">3</label>
                            <input type="radio" id="brushingTekanan-4" name="brushingTekananLevel" value="4" class="hidden"><label for="brushingTekanan-4" class="radio-label">4</label>
                            <input type="radio" id="brushingTekanan-5" name="brushingTekananLevel" value="5" class="hidden"><label for="brushingTekanan-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="brushingTekananSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="brushingTekananSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 5 menit tenang setelah brushing.">
                    </div>
                    <div>
                        <label for="brushingTekananCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="brushingTekananCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Catat perbedaan sebelum & sesudah brushing."></textarea>
                    </div>
                </div>

                <!-- Aktivitas 6: Rutinitas Mandi Visual -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-blue-700 mb-3">Rutinitas Mandi Visual</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Motorik Kasar, Motorik Halus, Kognitif, Komunikasi, Sensoris Integrasi, Sosial-Emosi.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Pemahaman urutan, transisi aktivitas.</p>
                    <p class="text-sm text-gray-600 mb-4">Penjelasan: Gunakan gambar untuk langkah mandi (üëï buka baju ‚Üí üöø guyur ‚Üí üß¥ sabun ‚Üí üí¶ bilas ‚Üí üßñ handuk).</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="rutinitasMandiVisual-1" name="rutinitasMandiVisualLevel" value="1" class="hidden"><label for="rutinitasMandiVisual-1" class="radio-label">1</label>
                            <input type="radio" id="rutinitasMandiVisual-2" name="rutinitasMandiVisualLevel" value="2" class="hidden"><label for="rutinitasMandiVisual-2" class="radio-label">2</label>
                            <input type="radio" id="rutinitasMandiVisual-3" name="rutinitasMandiVisualLevel" value="3" class="hidden"><label for="rutinitasMandiVisual-3" class="radio-label">3</label>
                            <input type="radio" id="rutinitasMandiVisual-4" name="rutinitasMandiVisualLevel" value="4" class="hidden"><label for="rutinitasMandiVisual-4" class="radio-label">4</label>
                            <input type="radio" id="rutinitasMandiVisual-5" name="rutinitasMandiVisualLevel" value="5" class="hidden"><label for="rutinitasMandiVisual-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="rutinitasMandiVisualSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="rutinitasMandiVisualSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: Ikut 4/5 langkah tanpa bantuan.">
                    </div>
                    <div>
                        <label for="rutinitasMandiVisualCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="rutinitasMandiVisualCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Amati apakah mengikuti urutan tanpa diingatkan."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bagian Terapi Wicara -->
        <div class="mb-10">
            <h2 class="section-header p-4 text-xl font-semibold text-gray-800 rounded-tr-lg rounded-br-lg mb-6">üó£Ô∏è Terapi Wicara Mandiri Harian (Kegiatan Rumah)</h2>
            <p class="text-gray-600 mb-6">Target: dari 1 kata ‚Üí 2 kata ‚Üí kalimat pendek</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Aktivitas A: Latihan 1 Kata ‚Üí 2 Kata -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-green-700 mb-3">A. Latihan 1 Kata ‚Üí 2 Kata</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Komunikasi, Kognitif, Motorik Halus (puzzle).</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Pemahaman & ekspresi visual-verbal.</p>
                    <p class="text-sm text-gray-600 mb-4">Kegiatan: Puzzle kecil ‚Üí sebut nama objek ‚Üí tambah deskripsi (‚Äúbola‚Äù ‚Üí ‚Äúbola merah‚Äù).</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="latihanSatuDuaKata-1" name="latihanSatuDuaKataLevel" value="1" class="hidden"><label for="latihanSatuDuaKata-1" class="radio-label">1</label>
                            <input type="radio" id="latihanSatuDuaKata-2" name="latihanSatuDuaKataLevel" value="2" class="hidden"><label for="latihanSatuDuaKata-2" class="radio-label">2</label>
                            <input type="radio" id="latihanSatuDuaKata-3" name="latihanSatuDuaKataLevel" value="3" class="hidden"><label for="latihanSatuDuaKata-3" class="radio-label">3</label>
                            <input type="radio" id="latihanSatuDuaKata-4" name="latihanSatuDuaKataLevel" value="4" class="hidden"><label for="latihanSatuDuaKata-4" class="radio-label">4</label>
                            <input type="radio" id="latihanSatuDuaKata-5" name="latihanSatuDuaKataLevel" value="5" class="hidden"><label for="latihanSatuDuaKata-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="latihanSatuDuaKataSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="latihanSatuDuaKataSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 3 kata baru.">
                    </div>
                    <div>
                        <label for="latihanSatuDuaKataCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="latihanSatuDuaKataCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Lihat apakah kata diingat keesokan hari."></textarea>
                    </div>
                </div>

                <!-- Aktivitas B: Gesture + Verbal Kombinasi -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-green-700 mb-3">B. Gesture + Verbal Kombinasi</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Sosial-Emosi, Komunikasi, Kognitif.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Menghubungkan gesture dan kata secara bersamaan untuk meningkatkan ekspresi verbal.</p>
                    <p class="text-sm text-gray-600 mb-4">Kegiatan: Anak menunjuk + mengucapkan kata sederhana (contoh: menunjuk air sambil berkata ‚Äúair‚Äù atau ‚Äúmau air‚Äù), lalu orang tua menanggapi sesuai konteks.</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="gestureVerbalKombinasi-1" name="gestureVerbalKombinasiLevel" value="1" class="hidden"><label for="gestureVerbalKombinasi-1" class="radio-label">1</label>
                            <input type="radio" id="gestureVerbalKombinasi-2" name="gestureVerbalKombinasiLevel" value="2" class="hidden"><label for="gestureVerbalKombinasi-2" class="radio-label">2</label>
                            <input type="radio" id="gestureVerbalKombinasi-3" name="gestureVerbalKombinasiLevel" value="3" class="hidden"><label for="gestureVerbalKombinasi-3" class="radio-label">3</label>
                            <input type="radio" id="gestureVerbalKombinasi-4" name="gestureVerbalKombinasiLevel" value="4" class="hidden"><label for="gestureVerbalKombinasi-4" class="radio-label">4</label>
                            <input type="radio" id="gestureVerbalKombinasi-5" name="gestureVerbalKombinasiLevel" value="5" class="hidden"><label for="gestureVerbalKombinasi-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="gestureVerbalKombinasiSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="gestureVerbalKombinasiSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 4 kombinasi gesture + kata dalam 1 sesi">
                    </div>
                    <div>
                        <label for="gestureVerbalKombinasiCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="gestureVerbalKombinasiCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Catat kombinasi yang berhasil tanpa dibantu."></textarea>
                    </div>
                </div>

                <!-- Aktivitas C: Respons Bahasa Tingkat Lanjut -->
                <div class="activity-card p-5 rounded-lg">
                    <h3 class="font-bold text-lg text-green-700 mb-3">C. Respons Bahasa Tingkat Lanjut</h3>
                    <p class="text-sm text-gray-600 mb-2">Kategori: Komunikasi, Kognitif.</p>
                    <p class="text-sm text-gray-600 mb-2">Tujuan: Melatih pemahaman instruksi multi-step dan diskriminasi objek.</p>
                    <p class="text-sm text-gray-600 mb-4">Kegiatan: Beri pertanyaan dua langkah (contoh: ‚ÄúAmbil ember dan taruh di kursi‚Äù) atau pertanyaan yang butuh penalaran sederhana (‚ÄúMana ember yang besar?‚Äù).</p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level Respons (1-5):</label>
                        <div class="flex flex-wrap gap-2">
                            <input type="radio" id="responsBahasaTingkatLanjut-1" name="responsBahasaTingkatLanjutLevel" value="1" class="hidden"><label for="responsBahasaTingkatLanjut-1" class="radio-label">1</label>
                            <input type="radio" id="responsBahasaTingkatLanjut-2" name="responsBahasaTingkatLanjutLevel" value="2" class="hidden"><label for="responsBahasaTingkatLanjut-2" class="radio-label">2</label>
                            <input type="radio" id="responsBahasaTingkatLanjut-3" name="responsBahasaTingkatLanjutLevel" value="3" class="hidden"><label for="responsBahasaTingkatLanjut-3" class="radio-label">3</label>
                            <input type="radio" id="responsBahasaTingkatLanjut-4" name="responsBahasaTingkatLanjutLevel" value="4" class="hidden"><label for="responsBahasaTingkatLanjut-4" class="radio-label">4</label>
                            <input type="radio" id="responsBahasaTingkatLanjut-5" name="responsBahasaTingkatLanjutLevel" value="5" class="hidden"><label for="responsBahasaTingkatLanjut-5" class="radio-label">5</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="responsBahasaTingkatLanjutSkor" class="block text-sm font-medium text-gray-700 mb-1">Skor/Kuantitas:</label>
                        <input type="text" id="responsBahasaTingkatLanjutSkor" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Contoh: 3/4 instruksi dua langkah dilakukan benar">
                    </div>
                    <div>
                        <label for="responsBahasaTingkatLanjutCatatan" class="block text-sm font-medium text-gray-700 mb-1">Catatan Detail:</label>
                        <textarea id="responsBahasaTingkatLanjutCatatan" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-gray-700" placeholder="Catat apakah anak perlu diulang atau bisa langsung paham."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tombol Aksi -->
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <button id="saveDataBtn" class="btn-primary flex-1 py-3 px-6 rounded-md text-lg font-semibold shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                <span class="mr-2">üíæ</span> Simpan Data & Perbarui Grafik
            </button>
            <button id="getSummaryBtn" class="btn-primary flex-1 py-3 px-6 rounded-md text-lg font-semibold shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                <span class="mr-2">‚ú®</span> Dapatkan Ringkasan Harian
            </button>
            <button id="clearDataBtn" class="btn-danger flex-1 py-3 px-6 rounded-md text-lg font-semibold shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75">
                <span class="mr-2">üóëÔ∏è</span> Hapus Semua Data
            </button>
        </div>

        <!-- AI Summary Output Area -->
        <div id="aiSummaryOutput" class="mb-10">
            <h3>Ringkasan Harian AI untuk Muhammad Syabil Raindra</h3>
            <p id="summaryText">Ringkasan akan muncul di sini setelah Anda mengklik "Dapatkan Ringkasan Harian".</p>
        </div>

        <!-- Bagian Grafik -->
        <div class="mb-10">
            <h2 class="section-header p-4 text-xl font-semibold text-gray-800 rounded-tr-lg rounded-br-lg mb-6">üìä Grafik Perkembangan Level Respons</h2>
            <div class="activity-card p-5 rounded-lg min-h-[300px] lg:min-h-[400px] flex items-center justify-center">
                <canvas id="developmentChart"></canvas>
            </div>
            <p class="text-sm text-gray-600 mt-4 text-center">Grafik ini menunjukkan Level Respons (1-5) anak Anda untuk setiap aktivitas dari waktu ke waktu. (1 = sangat sulit/butuh bantuan penuh, 5 = mudah/mandiri)</p>
        </div>

    </div>

    <!-- Custom Message Box HTML -->
    <div id="messageBoxOverlay" class="message-box-overlay">
        <div class="message-box-content">
            <h3 id="messageBoxTitle"></h3>
            <p id="messageBoxText"></p>
            <div class="message-box-actions" id="messageBoxActions">
                <!-- Buttons will be injected here -->
            </div>
        </div>
    </div>

    <!-- Loading Overlay HTML -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loader"></div>
        <p class="loading-text">Membuat ringkasan...</p>
    </div>

    <script>
        let myChart; // Variable to hold the Chart.js instance

        document.addEventListener('DOMContentLoaded', () => {
            // Retrieve __app_id and __firebase_config from global scope
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

            // Set default date to today
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            const recordDateInput = document.getElementById('recordDate');
            recordDateInput.value = `${year}-${month}-${day}`;

            const saveDataBtn = document.getElementById('saveDataBtn');
            const getSummaryBtn = document.getElementById('getSummaryBtn'); // New button
            const clearDataBtn = document.getElementById('clearDataBtn');
            const aiSummaryOutput = document.getElementById('aiSummaryOutput');
            const summaryText = document.getElementById('summaryText');
            const loadingOverlay = document.getElementById('loadingOverlay');

            // --- CUSTOM MESSAGE BOX FUNCTIONS ---
            const messageBoxOverlay = document.getElementById('messageBoxOverlay');
            const messageBoxTitle = document.getElementById('messageBoxTitle');
            const messageBoxText = document.getElementById('messageBoxText');
            const messageBoxActions = document.getElementById('messageBoxActions');

            /**
             * Displays a custom message box.
             * @param {string} title - The title of the message box.
             * @param {string} message - The message content.
             * @param {'alert'|'confirm'} type - The type of message box ('alert' or 'confirm').
             * @param {function} [callback] - Callback function for 'confirm' type, called with true/false.
             */
            const showMessageBox = (title, message, type, callback = null) => {
                messageBoxTitle.textContent = title;
                messageBoxText.textContent = message;
                messageBoxActions.innerHTML = ''; // Clear previous buttons

                if (type === 'alert') {
                    const okBtn = document.createElement('button');
                    okBtn.textContent = 'OK';
                    okBtn.classList.add('ok-btn');
                    okBtn.onclick = () => messageBoxOverlay.classList.remove('active');
                    messageBoxActions.appendChild(okBtn);
                } else if (type === 'confirm') {
                    const confirmBtn = document.createElement('button');
                    confirmBtn.textContent = 'Ya';
                    confirmBtn.classList.add('confirm-btn');
                    confirmBtn.onclick = () => {
                        messageBoxOverlay.classList.remove('active');
                        if (callback) callback(true);
                    };
                    const cancelBtn = document.createElement('button');
                    cancelBtn.textContent = 'Tidak';
                    cancelBtn.classList.add('cancel-btn');
                    cancelBtn.onclick = () => {
                        messageBoxOverlay.classList.remove('active');
                        if (callback) callback(false);
                    };
                    messageBoxActions.appendChild(confirmBtn);
                    messageBoxActions.appendChild(cancelBtn);
                }
                messageBoxOverlay.classList.add('active');
            };

            // --- LOADING INDICATOR FUNCTIONS ---
            const showLoading = (message = "Memuat...") => {
                loadingOverlay.querySelector('.loading-text').textContent = message;
                loadingOverlay.classList.add('active');
            };

            const hideLoading = () => {
                loadingOverlay.classList.remove('active');
            };

            // --- FUNCTIONS FOR LOCAL STORAGE ---

            // Loads data for the currently selected date, if available
            const loadDataForCurrentDate = () => {
                const storedData = getStoredData();
                const currentDate = recordDateInput.value;
                const dailyEntry = storedData.find(entry => entry.date === currentDate);

                if (dailyEntry) {
                    // Populate form fields with loaded data
                    dailyEntry.activities.forEach(activity => {
                        const scoreInput = document.getElementById(`${activity.id}Skor`);
                        const notesTextarea = document.getElementById(`${activity.id}Catatan`);
                        const levelRadios = document.querySelectorAll(`input[name="${activity.id}Level"]`);

                        if (scoreInput) scoreInput.value = activity.score || '';
                        if (notesTextarea) notesTextarea.value = activity.notes || '';
                        if (levelRadios) {
                            levelRadios.forEach(radio => {
                                radio.checked = radio.value === activity.level;
                            });
                        }
                    });
                } else {
                    // Clear form if no data for current date
                    clearForm();
                }
                // Hide summary output when date changes
                aiSummaryOutput.style.display = 'none';
                summaryText.textContent = 'Ringkasan akan muncul di sini setelah Anda mengklik "Dapatkan Ringkasan Harian".';
            };

            // Saves the current form data to local storage
            const saveDataToLocalStorage = () => {
                const recordDate = recordDateInput.value;
                const allActivityData = [];

                // Collect data for Neuro-Sensory Therapy activities
                const neuroSensoryActivities = [
                    { id: "tantanganCepat", name: "Tantangan Cepat", purpose: "Proprioseptif & vestibular, koordinasi tubuh, transisi fokus" },
                    { id: "pemimpinTim", name: "Pemimpin Tim", purpose: "Taktil + proprioseptif, keterampilan sosial, bahasa instruksi" },
                    { id: "targetJuara", name: "Target Juara", purpose: "Modulasi gerak, fokus visual, pengaturan tenaga" },
                    { id: "bosCerita", name: "Bos Cerita", purpose: "Auditori, pemahaman reseptif & ekspresif, menyusun urutan" },
                    { id: "brushingTekanan", name: "Brushing + Tekanan Dalam", purpose: "Taktil calming + proprioseptif, membantu tidur" },
                    { id: "rutinitasMandiVisual", name: "Rutinitas Mandi Visual", purpose: "Pemahaman urutan, transisi aktivitas" }
                ];
                neuroSensoryActivities.forEach(item => {
                    allActivityData.push({
                        id: item.id,
                        name: item.name,
                        purpose: item.purpose,
                        score: document.getElementById(`${item.id}Skor`).value,
                        level: getRadioValue(`${item.id}Level`),
                        notes: document.getElementById(`${item.id}Catatan`).value
                    });
                });

                // Collect data for Speech Therapy activities
                const speechTherapyActivities = [
                    { id: "latihanSatuDuaKata", name: "A. Latihan 1 Kata ‚Üí 2 Kata", purpose: "Pemahaman & ekspresi visual-verbal" },
                    { id: "gestureVerbalKombinasi", name: "B. Gesture + Verbal Kombinasi", purpose: "Menghubungkan gesture dan kata secara bersamaan untuk meningkatkan ekspresi verbal" },
                    { id: "responsBahasaTingkatLanjut", name: "C. Respons Bahasa Tingkat Lanjut", purpose: "Melatih pemahaman instruksi multi-step dan diskriminasi objek" }
                ];
                speechTherapyActivities.forEach(item => {
                    allActivityData.push({
                        id: item.id,
                        name: item.name,
                        purpose: item.purpose,
                        score: document.getElementById(`${item.id}Skor`).value,
                        level: getRadioValue(`${item.id}Level`),
                        notes: document.getElementById(`${item.id}Catatan`).value
                    });
                });

                let storedData = getStoredData();

                // Find if an entry for this date already exists
                const existingIndex = storedData.findIndex(entry => entry.date === recordDate);

                if (existingIndex > -1) {
                    // Update existing entry
                    storedData[existingIndex].activities = allActivityData;
                } else {
                    // Add new entry
                    storedData.push({ date: recordDate, activities: allActivityData });
                }

                // Sort data by date to ensure chart display is chronological
                storedData.sort((a, b) => new Date(a.date) - new Date(b.date));

                localStorage.setItem('childDevelopmentData', JSON.stringify(storedData));
                showMessageBox('Data Tersimpan', 'Data harian berhasil disimpan!', 'alert');
                renderChart(); // Re-render chart after saving
            };

            // Retrieves all data from local storage
            const getStoredData = () => {
                const data = localStorage.getItem('childDevelopmentData');
                return data ? JSON.parse(data) : [];
            };

            // Clears all form fields
            const clearForm = () => {
                document.querySelectorAll('input[type="text"]').forEach(input => input.value = '');
                document.querySelectorAll('textarea').forEach(textarea => textarea.value = '');
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
            };

            // --- FUNCTIONS FOR CHARTING ---

            const renderChart = () => {
                const storedData = getStoredData();
                const ctx = document.getElementById('developmentChart').getContext('2d');

                // Destroy existing chart instance if it exists
                if (myChart) {
                    myChart.destroy();
                }

                if (storedData.length === 0) {
                    // Display message if no data
                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); // Clear canvas
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillStyle = '#666'; // Gray text for clarity
                    ctx.fillText('Belum ada data untuk ditampilkan. Isi formulir dan simpan!', ctx.canvas.width / 2, ctx.canvas.height / 2);
                    return;
                }

                // Prepare data for Chart.js
                const labels = storedData.map(entry => {
                    const dateParts = entry.date.split('-');
                    return `${dateParts[2]}/${dateParts[1]}`; // Format as DD/MM
                }); // Dates for X-axis

                const datasets = [];
                const activityColors = [
                    '#3b82f6', // blue-500
                    '#16a34a', // green-600
                    '#f59e0b', // yellow-500
                    '#8b5cf6', // purple-500
                    '#ec4899', // pink-500
                    '#f97316', // orange-500
                    '#6b7280', // gray-500
                    '#06b6d4', // cyan-500
                    '#84cc16', // lime-500
                    '#f43f5e'  // rose-500
                ];
                let colorIndex = 0;

                const allActivityTypes = [
                    { id: "tantanganCepat", name: "Tantangan Cepat" },
                    { id: "pemimpinTim", name: "Pemimpin Tim" },
                    { id: "targetJuara", name: "Target Juara" },
                    { id: "bosCerita", name: "Bos Cerita" },
                    { id: "brushingTekanan", name: "Brushing + Tekanan Dalam" },
                    { id: "rutinitasMandiVisual", name: "Rutinitas Mandi Visual" },
                    { id: "latihanSatuDuaKata", name: "A. Latihan 1 Kata ‚Üí 2 Kata" },
                    { id: "gestureVerbalKombinasi", name: "B. Gesture + Verbal Kombinasi" },
                    { id: "responsBahasaTingkatLanjut", name: "C. Respons Bahasa Tingkat Lanjut" }
                ];

                allActivityTypes.forEach(activityMeta => {
                    const dataPoints = storedData.map(dailyEntry => {
                        const activity = dailyEntry.activities.find(a => a.id === activityMeta.id);
                        return activity && activity.level ? parseInt(activity.level) : null;
                    });

                    // Filter out datasets with no valid data
                    if (dataPoints.some(point => point !== null)) {
                         const baseColor = activityColors[colorIndex % activityColors.length];
                         colorIndex++; // Increment color index for the next activity

                         datasets.push({
                            label: activityMeta.name,
                            data: dataPoints,
                            backgroundColor: baseColor, // Set point background color
                            borderColor: baseColor,
                            borderWidth: 2, // Thicker lines
                            fill: false,    // Do not fill area under the line
                            tension: 0.1,   // Slight curve to lines
                            pointRadius: 5, // Larger points
                            pointBackgroundColor: baseColor,
                            pointBorderColor: '#fff',
                            pointHoverRadius: 7
                        });
                    }
                });

                myChart = new Chart(ctx, {
                    type: 'line', // Changed to 'line' chart type
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Perkembangan Level Respons Anak (Grafik Garis)', // Updated title for line chart
                                font: {
                                    size: 18,
                                    family: "Inter"
                                }
                            },
                            tooltip: {
                                mode: 'index', // Show tooltip for all lines on a specific date
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += `Level ${context.parsed.y}`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Tanggal',
                                    font: {
                                        family: "Inter"
                                    }
                                },
                                stacked: false // Not stacked for lines
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Level Respons (1 = Sulit, 5 = Mudah)',
                                    font: {
                                        family: "Inter"
                                    }
                                },
                                beginAtZero: false, // Important for showing variations in 1-5 range
                                min: 1, // Minimum value on Y-axis
                                max: 5, // Maximum value on Y-axis
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value, index, values) {
                                        if (value === 1) return '1 (Sulit)';
                                        if (value === 5) return '5 (Mudah)';
                                        return value;
                                    }
                                }
                            }
                        }
                    }
                });
            };

            // Function to get selected radio button value
            function getRadioValue(name) {
                const radios = document.querySelectorAll(`input[name="${name}"]:checked`);
                return radios.length > 0 ? radios[0].value : '';
            }

            // --- GEMINI API INTEGRATION ---

            // Exponential backoff retry function
            async function fetchWithExponentialBackoff(url, options, retries = 3, delay = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) {
                            // If response is not OK, it might be a rate limit or other server error
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response;
                    } catch (error) {
                        if (i < retries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                        } else {
                            throw error; // Re-throw error if max retries reached
                        }
                    }
                }
            }


            const getDailySummary = async () => {
                showLoading('Membuat ringkasan harian... Mohon tunggu.');
                aiSummaryOutput.style.display = 'block'; // Ensure summary area is visible
                summaryText.textContent = 'Memuat ringkasan...';

                const recordDate = recordDateInput.value;
                const storedData = getStoredData();
                const dailyEntry = storedData.find(entry => entry.date === recordDate);

                if (!dailyEntry || dailyEntry.activities.every(activity => !activity.notes && !activity.score && !activity.level)) {
                    summaryText.textContent = `Tidak ada catatan yang tersedia untuk tanggal ${recordDate}. Silakan isi data terlebih dahulu.`;
                    hideLoading();
                    return;
                }

                let promptNotes = "";
                dailyEntry.activities.forEach(activity => {
                    const notes = activity.notes ? `Catatan: ${activity.notes}` : '';
                    const score = activity.score ? `Skor/Kuantitas: ${activity.score}` : '';
                    const level = activity.level ? `Level Respons: ${activity.level}` : '';

                    if (notes || score || level) {
                        promptNotes += `\n- ${activity.name}:\n`;
                        if (level) promptNotes += `  Level: ${level}\n`;
                        if (score) promptNotes += `  Skor: ${score}\n`;
                        if (notes) promptNotes += `  Catatan: ${notes}\n`;
                    }
                });

                if (!promptNotes.trim()) {
                    summaryText.textContent = `Tidak ada catatan detail yang tersedia untuk tanggal ${recordDate}. Silakan isi data terlebih dahulu.`;
                    hideLoading();
                    return;
                }

                const prompt = `Berikut adalah catatan harian observasi perilaku dan respons sensoris Muhammad Syabil Raindra pada tanggal ${recordDate}. Mohon berikan ringkasan singkat (maksimal 3-4 kalimat) dan poin-poin penting dari observasi ini, fokus pada kemajuan, tantangan, dan pola yang terlihat terkait dengan kebutuhan sensoris dan terapi bicara.
Nama anak: Muhammad Syabil Raindra, 6 tahun, ADHD + tantangan regulasi sensoris (SPD), Tipe ADHD Dominan: Hyper taktil, Hypo proprioseptif, Kesulitan modulasi gerakan, Fokus sangat visual-kines.
Catatan observasi:\n${promptNotes.trim()}`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // If you want to use models other than gemini-2.5-flash-preview-05-20 or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetchWithExponentialBackoff(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        summaryText.textContent = text;
                    } else {
                        summaryText.textContent = 'Maaf, tidak dapat menghasilkan ringkasan. Struktur respons API tidak terduga.';
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    summaryText.textContent = `Maaf, terjadi kesalahan saat menghubungi AI. Silakan coba lagi. (${error.message})`;
                } finally {
                    hideLoading();
                }
            };


            // --- EVENT LISTENERS ---

            saveDataBtn.addEventListener('click', saveDataToLocalStorage);
            getSummaryBtn.addEventListener('click', getDailySummary); // Event listener for new button

            clearDataBtn.addEventListener('click', () => {
                showMessageBox(
                    'Konfirmasi Hapus Data',
                    'Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak bisa dibatalkan.',
                    'confirm',
                    (result) => {
                        if (result) {
                            localStorage.removeItem('childDevelopmentData');
                            showMessageBox('Data Dihapus', 'Semua data telah dihapus.', 'alert');
                            clearForm();
                            renderChart(); // Clear the chart
                            aiSummaryOutput.style.display = 'none'; // Hide summary
                            summaryText.textContent = 'Ringkasan akan muncul di sini setelah Anda mengklik "Dapatkan Ringkasan Harian".';
                        }
                    }
                );
            });

            // Load data and render chart when the date input changes or on initial load
            recordDateInput.addEventListener('change', loadDataForCurrentDate);

            // Initial load and render
            loadDataForCurrentDate();
            renderChart();
        });
    </script>
</body>
</html>
